{% extends "base.html" %}

{% block title %}My Profile{% endblock %}

{% block content %}

{% if current_user.is_authenticated %}

{% for item in timeline %}

    {% if item.__class__.__name__ == "Post" %}
        {# =======================
           POST NORMAL
           ======================= #}
        <div class="post">
            <p><strong>{{ item.author.username }}</strong> publicou:</p>
            <p>{{ item.date.astimezone().strftime("%d/%m/%Y %H:%M") }}</p>

            <h3>{{ item.title }}</h3>
            <p>{{ item.body }}</p>

            {% if item.post_pic %}
                <img src="{{ url_for('static', filename='post_pics/' ~ item.post_pic) }}" class="post-pic">
            {% endif %}

            <a href="{{ url_for('user.see_post', post_id=item.id) }}">Ver post</a>
        </div>

    {% else %}
        {# ======================
        POST COMPARTILHADO
        ====================== #}
        <div class="post shared">
            <p><strong>{{ item.author.username }}</strong> compartilhou:</p>
            <p>{{ item.date.astimezone().strftime("%d/%m/%Y %H:%M") }}</p>

            {% if item.body %}
                <p><em>{{ item.body }}</em></p>
            {% endif %}

            {# ----- CASO 1: Shared de um Post ----- #}
            {% if item.post %}
                <div class="original-post">
                    <p><strong>{{ item.post.author.username }}</strong> escreveu:</p>

                    <h4>{{ item.post.title }}</h4>
                    <p>{{ item.post.body }}</p>

                    {% if item.post.post_pic %}
                        <img src="{{ url_for('static', filename='post_pics/' ~ item.post.post_pic) }}" class="post-pic">
                    {% endif %}
                </div>

            {# ----- CASO 2: Shared de um Shared ----- #}
            {% elif item.parent_shared %}
                <div class="original-post">
                    <p><strong>{{ item.parent_shared.author.username }}</strong> compartilhou:</p>

                    {% if item.parent_shared.body %}
                        <p><em>{{ item.parent_shared.body }}</em></p>
                    {% endif %}

                    <div class="chained-shared">
                        {# Aqui exibimos o post original da cadeia #}
                        <p><strong>{{ item.parent_shared.post.author.username }}</strong> escreveu:</p>

                        <h4>{{ item.parent_shared.post.title }}</h4>
                        <p>{{ item.parent_shared.post.body }}</p>

                        {% if item.parent_shared.post.post_pic %}
                            <img src="{{ url_for('static', filename='post_pics/' ~ item.parent_shared.post.post_pic) }}" class="post-pic">
                        {% endif %}
                    </div>
                </div>

            {% else %}
                <p style="color:red;">Erro: este compartilhamento n√£o tem post e nem shared!</p>
            {% endif %}
        </div>

    {% endif %}

    <hr>

{% endfor %}

{% endif %}

{% endblock %}
